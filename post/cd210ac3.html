<!DOCTYPE html><script type="text/javascript" src="\js\FunnyTitle.js"></script><html lang="zh-CN"><script type="text/javascript" color="220,220,220" opacity="0.7" zindex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"josephsun.cn",root:"/",scheme:"Mist",version:"7.8.0",exturl:!1,sidebar:{position:"right",display:"always",padding:18,offset:12,onmobile:!0},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="相关分析相关分析需要建立在因果条件下，不可倒置简单线性相关相关分析(Correlation)测试随机变量之间的统计依赖性(dependence)相关系数(Coefficients)定量给出相关性的大小相关性不能用于推断变量之间的因果关系(Causal relationship)Pearson’s 相关Pearson’s r ：是一种参数方法，衡量变量之间的线性相关性，反映整个样本的平均响应。两个变"><meta property="og:type" content="article"><meta property="og:title" content="[空间分析]肆·地理统计-相关分析"><meta property="og:url" content="https://josephsun.cn/post/cd210ac3.html"><meta property="og:site_name" content="JosephSun&#39;s Blogs"><meta property="og:description" content="相关分析相关分析需要建立在因果条件下，不可倒置简单线性相关相关分析(Correlation)测试随机变量之间的统计依赖性(dependence)相关系数(Coefficients)定量给出相关性的大小相关性不能用于推断变量之间的因果关系(Causal relationship)Pearson’s 相关Pearson’s r ：是一种参数方法，衡量变量之间的线性相关性，反映整个样本的平均响应。两个变"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/image-20210119132450244.png"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/image-20210119133653039.png"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/image-20210119134553677.png"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/image-20210119135035288.png"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/image-20210119135128102.png"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/image-20210119135524703.png"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/pairplot.png"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/kdeplot&amp;scatter.png"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/heatmap.png"><meta property="og:image" content="https://josephsun.cn/post/cd210ac3/clustermap.png"><meta property="article:published_time" content="2021-01-19T06:39:19.000Z"><meta property="article:modified_time" content="2021-01-19T06:40:02.930Z"><meta property="article:author" content="JoeSun"><meta property="article:tag" content="空间分析"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://josephsun.cn/post/cd210ac3/image-20210119132450244.png"><link rel="canonical" href="https://josephsun.cn/post/cd210ac3.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>[空间分析]肆·地理统计-相关分析 | JosephSun's Blogs</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-156331840-2"></script><script>function gtag(){dataLayer.push(arguments)}CONFIG.hostname===location.hostname&&(window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-156331840-2"))</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?1263cea084ac2c7b896396b81f9a4fbc";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">JosephSun's Blogs</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">孙先生的失眠日记</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-cv"><a href="/CV/" rel="section"><i class="fa fa-user fa-fw"></i>简历</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-archive fa-fw"></i>关于</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://josephsun.cn/post/cd210ac3.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="JoeSun"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="JosephSun's Blogs"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">[空间分析]肆·地理统计-相关分析</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-01-19 14:39:19 / 修改时间：14:40:02" itemprop="dateCreated datePublished" datetime="2021-01-19T14:39:19+08:00">2021-01-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E7%A9%BA%E9%97%B4%E5%88%86%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">空间分析</span></a> </span></span><span id="/post/cd210ac3.html" class="post-meta-item leancloud_visitors" data-flag-title="[空间分析]肆·地理统计-相关分析" title="热度"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">热度：</span> <span class="leancloud-visitors-count"></span> <span>℃</span> </span><span class="post-meta-item" title="热度" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">热度：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span>6.2k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span>6 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="相关分析"><a href="#相关分析" class="headerlink" title="相关分析"></a>相关分析</h2><p><strong>相关分析需要建立在因果条件下，不可倒置</strong></p><h4 id="简单线性相关"><a href="#简单线性相关" class="headerlink" title="简单线性相关"></a>简单线性相关</h4><ul><li>相关分析(Correlation)测试随机变量之间的统计依赖性(dependence)</li><li>相关系数(Coefficients)定量给出相关性的大小</li><li>相关性不能用于推断变量之间的因果关系(Causal relationship)</li></ul><h5 id="Pearson’s-相关"><a href="#Pearson’s-相关" class="headerlink" title="Pearson’s 相关"></a>Pearson’s 相关</h5><p>Pearson’s r ：是一种参数方法，衡量变量之间的<strong>线性</strong>相关性，反映整个样本的平均响应。</p><p>两个变量(X, Y)的皮尔森相关性系数(ρX,Y)等于它们之间的协方差cov(X,Y)除以它们各自标准差的乘积(σX, σY)。</p><p>Pearson’s r 的计算和特性：</p><ul><li><p>$-1 ≤ r ≤ +1$</p><ul><li>-1 negative 负相关</li><li>0 no linear relationship 不相关</li><li>1 positive 正相关</li></ul></li><li><p>总体：$\rho = \frac{cov(X,Y)}{\sigma_X\sigma_Y}$</p><p>样本：$r <em>{ x y } = \frac { \sum </em>{ i = 1 } ^ { n } ( x <em>{ i } - \overline { x } ) ( y </em>{ i } - \overline { y } ) } { \sqrt { \sum <em>{ i = 1 } ^ { n } ( x </em>{ i } - \overline { x } ) ^ { 2 } } \sqrt { \sum <em>{ i = 1 } ^ { n } ( y </em>{ i } - \overline { y } ) ^ { 2 } } }$</p></li></ul><h6 id="如何理解？"><a href="#如何理解？" class="headerlink" title="如何理解？"></a>如何理解？</h6><p>从皮尔森的公式看，分母是变量的标准差，这就意味着计算皮尔森相关性系数时，变量的标准差不能为0（分母不能为0），也就是说两个变量中任何一个的值不能都是相同的。如果没有变化，用皮尔森相关系数是没办法算出这个变量与另一个变量之间是不是有相关性的。</p><p>就好比我们想研究人跑步的速度与心脏跳动的相关性，如果你无论跑多快，心跳都不变（即心跳这个变量的标准差为0），或者你心跳忽快忽慢的，却一直保持一个速度在跑（即跑步速度这个变量的标准差为0），那我们都无法通过皮尔森相关性系数的计算来判断心跳与跑步速度到底相不相关。</p><p>皮尔森相关性系数是协方差与标准差的比值，所以它对数据是有比较高的要求的：</p><ol><li>实验数据通常假设是成对的来自于正态分布的总体。因为我们在求皮尔森相关性系数以后，通常还会用t检验之类的方法来进行皮尔森相关性系数检验，而 t检验是基于数据呈正态分布的假设的。</li><li>实验数据之间的差距不能太大，或者说皮尔森相关性系数受异常值的影响比较大。比如刚才心跳与跑步的例子，万一这个人的心脏不太好，跑到一定速度后承受不了，突发心脏病，那这时候我们会测到一个偏离正常值的心跳（过快或者过慢，甚至为0），如果我们把这个值也放进去进行相关性分析，它的存在会大大干扰计算的结果的。</li></ol><h5 id="Partial-correlation-偏相关"><a href="#Partial-correlation-偏相关" class="headerlink" title="Partial correlation 偏相关"></a>Partial correlation 偏相关</h5><p>参与了第三个变量因素，可以考虑控制或者移除。</p><p><strong>使用偏相关前提在于已经知道三者相关，不可替代因果推断。</strong></p><ul><li>Partial correlation 用于测量在控制变量效应移除的情况下，两个随机变量的统计依赖程度；</li><li>主要是基于这样一个事实：如果存在与两个变量都有相关性的混淆变量时，相关系数通常会给出一个有 misleading 的结果。</li><li>当顾及其他影响因素时候，变量之间的相关性会改变 - 多因素相互作用的复杂性</li></ul><h6 id="如何理解？-1"><a href="#如何理解？-1" class="headerlink" title="如何理解？"></a>如何理解？</h6><p>皮尔森相关分析通过计算两个变量之间的相关系数，分析变量间线性相关的程度，在多元相关分析中，由于受到其他变量的影响，皮尔森相关系数只能从表面上反映两个变量相关的性质，往往不能真实地反映变量之间的线性相关程度，甚至会给人造成相关的假象，因此，在某些场合，简单的皮尔森相关系数并不是刻画相关关系的本质统计量。</p><p>当其他变量被固定住，即将他们控制起来后，给定的任意两个变量之间的相关系数叫偏相关系数，偏相关系数才是真正反映两个变量相关关系的统计量。</p><p>举个栗子，有研究说游泳可以促进冷饮的销售，即游泳的人越多，冷饮的销售量也越多。假如我们获取的数据两者确实是呈现皮尔森正相关，且具有显著性意义。那么我们真的能根据这个结果就判定：冷饮销售量和游泳人数存在内在关联吗？</p><p>请注意全文开篇第一句话：<strong>相关分析要建立在建立在因果条件之下。</strong></p><p>偏相关，仍然是在计算两个变量的相关系数，与之前学习的相关区别在于，计算“偏相关系数”时可以再引入其他的变量，这些变量我们称之为“控制变量”。所以，采用偏相关可以控制混杂。</p><p>接着上面的例子，为什么不能通过两个变量之间的皮尔森相关系数来判断两者真实地存在相关甚至是因果呢？很明显，冷饮销售量增加和游泳人数地增加都可能与“天气热”相联系，所以，很有可能是因为天气热导致吃冷饮的人和游泳的人同时增加。</p><p>所以在引入气温变量的条件下，再去计算皮尔森相关。</p><h4 id="Spearman’s-rank-correlation-秩相关"><a href="#Spearman’s-rank-correlation-秩相关" class="headerlink" title="Spearman’s rank correlation 秩相关"></a>Spearman’s rank correlation 秩相关</h4><p>Spearman’s rho 是一种测试统计依赖性的非参数方法，适用于连续与离散型变量，刻画的是随机变量之间的<strong>单调</strong>（monotonic）关系，测量的是样本对应排序的响应，与绝对值大小无关，对异常值不敏感。</p><p>Spearman’s rho 定义与计算:</p><ul><li>$\rho = 1-\frac{6 \sum d^2 _i}{n(n^2 -1)}$</li><li>$d_i = rg(X_i)-rg(Y_i)$</li><li>$d_i$是对应观测值的顺序差，n为观测个数</li></ul><h6 id="如何理解？-2"><a href="#如何理解？-2" class="headerlink" title="如何理解？"></a>如何理解？</h6><p>斯皮尔曼相关性系数，通常也叫斯皮尔曼秩相关系数。“秩”，可以理解成就是一种顺序或者排序，那么它就是根据原始数据的排序位置进行求解，这种表征形式就没有了求皮尔森相关性系数时那些限制。不用管X和Y这两个变量具体的值到底差了多少，只需要算一下它们每个值所处的排列位置的差值，就可以求出相关性系数了。而且，即便在变量值没有变化的情况下，也不会出现像皮尔森系数那样分母为0而无法计算的情况。另外，即使出现异常值，由于异常值的秩次通常不会有明显的变化（比如过大或者过小，那要么排第一，要么排最后），所以对斯皮尔曼相关性系数的影响也非常小！</p><h4 id="Kendall-correlation-分类变量的秩相关"><a href="#Kendall-correlation-分类变量的秩相关" class="headerlink" title="Kendall correlation 分类变量的秩相关"></a>Kendall correlation 分类变量的秩相关</h4><p>肯德尔相关性系数，又称肯德尔秩相关系数，它也是一种秩相关系数，不过它所计算的对象是分类变量。<br>分类变量可以理解成有类别的变量，可以分为</p><p>无序的，比如性别（男、女）、血型（A、B、O、AB）；</p><p>有序的，比如肥胖等级（重度肥胖，中度肥胖、轻度肥胖、不肥胖）。</p><p>通常需要求相关性系数的都是有序分类变量。</p><p>举个例子。比如评委对选手的评分（优、中、差等），我们想看两个（或者多个）评委对几位选手的评价标准是否一致；或者医院的尿糖化验报告，想检验各个医院对尿糖的化验结果是否一致，这时候就可以使用肯德尔相关性系数进行衡量。</p><p>由于数据情况不同，求得肯德尔相关性系数的计算公式不一样，一般有3种计算公式，此处不再论述有兴趣可以自行百度。</p><h4 id="R实现及可视化"><a href="#R实现及可视化" class="headerlink" title="R实现及可视化"></a>R实现及可视化</h4><p>数据来源：来源于美国50个州在1977年的人口，收入，文盲率，预期寿命，谋杀率以及高中毕业率的数据。</p><p>导入数据并查看数据信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">states &lt;- state.x77[,1:6]</span><br><span class="line">head(states)</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/image-20210119132450244.png" alt="image-20210119132450244"></p><p>R语言为相关分析提供了函数 <code>cor</code>，method默认参数是用pearson；并且遇到缺失值，use默认参数everything，所以结果会是NA.</p><blockquote><p>可以采用<code>is.na(states)</code> 检查是否有缺失值。</p></blockquote><p>前提我们已经知道了人口和收入具有一定相关性，然后我们可以进行相关分析。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; cor(states[,<span class="string">"Population"</span>],states[,<span class="string">"Income"</span>],method = <span class="string">"pearson"</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.2082276</span></span><br><span class="line">&gt; cor(states[,<span class="string">"Population"</span>],states[,<span class="string">"Income"</span>],method = <span class="string">"spearman"</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.1246098</span></span><br></pre></td></tr></table></figure><p>人口和收入结果具有线性的弱相关和无关的秩相关。由于人口和收入并不是分类数据，就不进行<code>kendall</code> 相关分析了。</p><p>可以对整个矩阵对个变量进行相关性计算，结果也是矩阵</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cor(states)</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/image-20210119133653039.png" alt="image-20210119133653039"></p><p>计算相关性的显著性则可以用 <code>cor.test</code> 函数，method默认是pearson，alternative默认是双尾（即总体相关系数不等于0）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; cor.test(states[,&quot;Population&quot;], states[,&quot;Income&quot;],method &#x3D; &quot;pearson&quot;)</span><br><span class="line"></span><br><span class="line">	Pearson&#39;s product-moment correlation</span><br><span class="line"></span><br><span class="line">data:  states[, &quot;Population&quot;] and states[, &quot;Income&quot;]</span><br><span class="line">t &#x3D; 1.475, df &#x3D; 48, p-value &#x3D; 0.1467</span><br><span class="line">alternative hypothesis: true correlation is not equal to 0</span><br><span class="line">95 percent confidence interval:</span><br><span class="line"> -0.07443435  0.45991855</span><br><span class="line">sample estimates:</span><br><span class="line">      cor </span><br><span class="line">0.2082276</span><br></pre></td></tr></table></figure><p>结果给出了p值和置信区间，并不显著的弱相关。</p><p><code>cor.test</code>只能用于计算两个变量的相关性检验，如果对多个变量或者矩阵数据的话，则可以使用psych包的<code>corr.test</code>函数</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">corr.test(states, use = <span class="string">"complete"</span>, method = <span class="string">"pearson"</span>, adjust = <span class="string">"none"</span>)</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/image-20210119134553677.png" alt="image-20210119134553677"></p><p>上面矩阵是相关系数，下面是p值(参数并未进行校正)。</p><p>论文一般不直接堆数据进去，那么就涉及<strong>可视化</strong></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">library</span>(corrplot)</span><br><span class="line">&gt; res_cor &lt;- cor(states)</span><br><span class="line">&gt; corrplot(corr=res_cor)</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/image-20210119135035288.png" alt="image-20210119135035288"></p><p>有点丑，加一点点修饰。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; corrplot(corr = res_cor,order = <span class="string">"AOE"</span>,type=<span class="string">"upper"</span>,tl.pos = <span class="string">"d"</span>)</span><br><span class="line">&gt; corrplot(corr = res_cor,add=<span class="literal">TRUE</span>, type=<span class="string">"lower"</span>, method=<span class="string">"number"</span>,order=<span class="string">"AOE"</span>,diag=<span class="literal">FALSE</span>,tl.pos=<span class="string">"n"</span>, cl.pos=<span class="string">"n"</span>)</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/image-20210119135128102.png" alt="image-20210119135128102"></p><p>如果遇到节约的老板还想你做个大体趋势，放在一张图里，而且还要黑白。</p><p>PerformanceAnalytics包的<code>chart.Correlation</code>函数也是用于可视化相关系数矩阵的</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">library</span>(<span class="string">'PerformanceAnalytics'</span>)</span><br><span class="line">&gt; chart.Correlation(states, method = <span class="string">"pearson"</span>)</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/image-20210119135524703.png" alt="image-20210119135524703"></p><h4 id="Python实现相关分析及可视化"><a href="#Python实现相关分析及可视化" class="headerlink" title="Python实现相关分析及可视化"></a>Python实现相关分析及可视化</h4><p>把上文用的数据导出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write.table (states, file &#x3D;&quot;a.csv&quot;)</span><br></pre></td></tr></table></figure><p>如果不知道导出到哪里了，可以用<code>getwd()</code>，查看运行目录。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 导入库</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import pandas as pd</span><br><span class="line">import seaborn as sns</span><br><span class="line">import os</span><br><span class="line">import scipy.stats as stats</span><br><span class="line"># 导入数据</span><br><span class="line">path &#x3D; os.path.join(&quot;.&quot;)</span><br><span class="line">filename &#x3D; os.path.join(path,&quot;a.csv&quot;)</span><br><span class="line">dt &#x3D; pd.read_csv(filename,header&#x3D;[0])</span><br><span class="line"># 相关分析</span><br><span class="line">dt.corr(&#39;pearson&#39;)</span><br><span class="line"># dt.corr(&#39;spearman&#39;)</span><br><span class="line"># dt.corr(&#39;kendall&#39;)</span><br><span class="line"># 计算相关性的显著性stats.pearsonr()，输出结果第一个值为pearsonr相关系数, 第二个为p-value</span><br><span class="line">print(stats.pearsonr(dt[&#39;Population&#39;],dt[&#39;Income&#39;]))</span><br></pre></td></tr></table></figure><p>下面是可视化</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.pairplot(dt)</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/pairplot.png" alt="pairplot"></p><p>如果需要显示核密度图。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">g &#x3D; sns.PairGrid(dt)</span><br><span class="line">g.map_diag(sns.histplot)</span><br><span class="line">g.map_upper(plt.scatter)</span><br><span class="line">g.map_lower(sns.kdeplot)</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/kdeplot&amp;scatter.png" alt="kdeplot&amp;scatter"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">corr &#x3D; dt.corr(method&#x3D;&#39;pearson&#39;)</span><br><span class="line">#以corr的形状生成一个全为0的矩阵</span><br><span class="line">mask &#x3D; np.zeros_like(corr)</span><br><span class="line">#将mask的对角线及以上设置为True</span><br><span class="line">#这部分就是对应要被遮掉的部分</span><br><span class="line">mask[np.triu_indices_from(mask)] &#x3D; True</span><br><span class="line">plt.subplots(figsize&#x3D;(15, 15))  # 分辨率1200×1000</span><br><span class="line">with sns.axes_style(&quot;white&quot;):</span><br><span class="line">   sns.heatmap(corr, mask&#x3D;mask,annot&#x3D;True,cmap&#x3D;&quot;RdBu_r&quot;,  # 在单元格中标注数据值</span><br><span class="line">               annot_kws&#x3D;&#123;&#39;fontsize&#39;: 12&#125; # 热图，将矩形数据绘制为颜色编码矩阵</span><br><span class="line">               )</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/heatmap.png" alt="heatmap"></p><p>如果需要聚类，则采用下面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">corr &#x3D; dt.corr(method&#x3D;&#39;pearson&#39;)</span><br><span class="line">with sns.axes_style(&quot;white&quot;):</span><br><span class="line">   sns.clustermap(corr,annot&#x3D;True,cmap&#x3D;&quot;RdBu_r&quot;,  # 在单元格中标注数据值</span><br><span class="line">               annot_kws&#x3D;&#123;&#39;fontsize&#39;: 12&#125; # 热图，将矩形数据绘制为颜色编码矩阵</span><br><span class="line">               )</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="/post/cd210ac3/clustermap.png" alt="clustermap"></p><p><strong>参考文献</strong></p><p>马廷老师的ppt</p><p>《基础地理统计学》</p><p>seaborn官方文档</p><p>pandas官方文档</p><p>Wiki维基百科</p><p><a href="https://www.bioinfo-scrounger.com/archives/603/" target="_blank" rel="noopener">https://www.bioinfo-scrounger.com/archives/603/</a></p><p><a href="http://rcompanion.org/handbook/I_10.html" target="_blank" rel="noopener">http://rcompanion.org/handbook/I_10.html</a></p><p><a href="https://blog.csdn.net/u013421629/article/details/72771241" target="_blank" rel="noopener">https://blog.csdn.net/u013421629/article/details/72771241</a></p><p><a href="https://www.bioinfo-scrounger.com/archives/603/" target="_blank" rel="noopener">https://www.bioinfo-scrounger.com/archives/603/</a></p><p><a href="https://blog.csdn.net/t15600624671/article/details/77247822?utm_medium=distribute.pc_relevant_t0.none-task-blog-searchFromBaidu-1.control&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-searchFromBaidu-1.control" target="_blank" rel="noopener">https://blog.csdn.net/t15600624671/article/details/77247822?utm_medium=distribute.pc_relevant_t0.none-task-blog-searchFromBaidu-1.control&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-searchFromBaidu-1.control</a></p><p><a href="https://blog.csdn.net/ruthywei/article/details/82533595" target="_blank" rel="noopener">https://blog.csdn.net/ruthywei/article/details/82533595</a></p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E7%A9%BA%E9%97%B4%E5%88%86%E6%9E%90/" rel="tag"><i class="fa fa-tag"></i> 空间分析</a></div><div class="post-nav"><div class="post-nav-item"><a href="/post/88f0d19d.html" rel="prev" title="[空间分析]-叁·地理统计7"><i class="fa fa-chevron-left"></i> [空间分析]-叁·地理统计7</a></div><div class="post-nav-item"></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#相关分析"><span class="nav-number">1.</span> <span class="nav-text">相关分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简单线性相关"><span class="nav-number">1.0.1.</span> <span class="nav-text">简单线性相关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Pearson’s-相关"><span class="nav-number">1.0.1.1.</span> <span class="nav-text">Pearson’s 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#如何理解？"><span class="nav-number">1.0.1.1.1.</span> <span class="nav-text">如何理解？</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Partial-correlation-偏相关"><span class="nav-number">1.0.1.2.</span> <span class="nav-text">Partial correlation 偏相关</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#如何理解？-1"><span class="nav-number">1.0.1.2.1.</span> <span class="nav-text">如何理解？</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spearman’s-rank-correlation-秩相关"><span class="nav-number">1.0.2.</span> <span class="nav-text">Spearman’s rank correlation 秩相关</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#如何理解？-2"><span class="nav-number">1.0.2.0.1.</span> <span class="nav-text">如何理解？</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kendall-correlation-分类变量的秩相关"><span class="nav-number">1.0.3.</span> <span class="nav-text">Kendall correlation 分类变量的秩相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#R实现及可视化"><span class="nav-number">1.0.4.</span> <span class="nav-text">R实现及可视化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Python实现相关分析及可视化"><span class="nav-number">1.0.5.</span> <span class="nav-text">Python实现相关分析及可视化</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="JoeSun" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">JoeSun</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">27</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/JosephSun-6" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;JosephSun-6" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:417773447@qq.com" title="E-Mail → mailto:417773447@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><div id="myCanvasContainer" class="widget tagcloud"><canvas width="220" height="250" id="resCanvas"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DeeperLearning/" rel="tag">DeeperLearning</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDL/" rel="tag">IDL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VS/" rel="tag">VS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arcgis-for-js/" rel="tag">arcgis for js</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%A9%E5%BA%A6%E5%8F%8D%E6%BC%94/" rel="tag">温度反演</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB/" rel="tag">生活</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A9%BA%E9%97%B4%E5%88%86%E6%9E%90/" rel="tag">空间分析</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a><span class="tag-list-count">1</span></li></ul></canvas></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">晋ICP备20000688号-1 </a><img src="/image/beian.jpg" style="display:inline-block"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=14082702000119" rel="noopener" target="_blank">晋公网备案 14082702000119号</a></div><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">JoeSun</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">86k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">1:18</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script>(function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"lGA8jDiu9xwPn8eGaVF2Ne2q-gzGzoHsz","app_key":"lI98i4LNGKqPDmaQTixb93yG","security":false,"betterPerformance":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();</script></div></footer></div><script color="0,0,254" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>!function(){var e,t,o,n,r=document.getElementsByTagName("link");if(0<r.length)for(i=0;i<r.length;i++)"canonical"==r[i].rel.toLowerCase()&&r[i].href&&(e=r[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,n=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",n?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)}()</script><script>if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}</script><script>if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }</script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'lGA8jDiu9xwPn8eGaVF2Ne2q-gzGzoHsz',
      appKey     : 'lI98i4LNGKqPDmaQTixb93yG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>